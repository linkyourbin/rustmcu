<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>00：点亮LED（GPIO） | RUST MCU BLOG</title><meta name=keywords content="GPIO,easy"><meta name=description content='

硬件准备

STM32开发板*1
烧录器*1

推荐使用ST-Link


LED*1

若有板载LED，则无需准备


杜邦线若干


硬件接线

  
      
          Peri
          STM32
      
  
  
      
          LED
          PC0
      
      
          ST-Link SWDIO
          SWDIO/PA13
      
      
          ST-Link SWCLK
          SWCLk/PA14
      
      
          ST-Link GND
          GND
      
      
          ST-Link 3V3
          3V3
      
  

电路部分，如上表即可，不涉及其他外设，这样简单接线就可以工作，但是更推荐的做法是，使用Type-C/USB给板子5V供电，5V直流通过LDO或者DC/DC转为3V3后再给相应外设板子供电，这样会更稳定，若是部分外设需要5V供电，但系统里并未接入5V直流，则会导致外设无响应，或工作不正常，这是需要注意的一个点。

创建工程
一般来说，可以直接使用一些别人写好的工具来创建模板（在crates.io上可以找到），类似esp-generate这样的工具，但是，由于rust+embassy一直都很活跃，使用别人的模板，难以保证体验最新特性，所以，介绍一下如何从cargo new xxx开始一个嵌入式rust的工程。
创建空白工程

创建一个空白工程

打开终端，输入：


1


cargo new stm32_blinky


注意：工程名最好是snake_case。


使用vscode打开所创建的工程

工程目录如下图所示，标准的hello world工程。

移植embassy
参考embassy仓库的工程进行工程移植，点击跳转embassy stm32f4 examples
在自己的工程根目录里创建两个目录，并且新建文件


1
2


.config/config.toml
.vscode/settings.json


将以下图中内容，复制到.cargo/config.toml里



1
2
3
4
5
6
7
8
9


[target.&#39;cfg(all(target_arch = "arm", target_os = "none"))&#39;]
# replace STM32F407VETx with your chip as listed in `probe-rs chip list`
runner = "probe-rs run --chip STM32F407VETx"

[build]
target = "thumbv7em-none-eabihf"

[env]
DEFMT_LOG = "trace"


注意：以上内容并不是照抄，需要按照自己的开发板具体型号来适配芯片名称（--chip xxx），还有编译器（target = "xxx"）。'><meta name=author content="linkyourbin"><link rel=canonical href=http://localhost:1313/stm32/blinky/><link crossorigin=anonymous href=/assets/css/stylesheet.36819bea596090d8b48cf10d9831382996197aa7e4fc86f792f7c08c9ca4d23b.css integrity="sha256-NoGb6llgkNi0jPENmDE4KZYZeqfk/Ib3kvfAjJyk0js=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=http://localhost:1313/stm32/blinky/index.xml><link rel=alternate hreflang=en href=http://localhost:1313/stm32/blinky/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="RUST MCU BLOG (Alt + H)">RUST MCU BLOG</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/categories/home title=Home><span><i class='fa fa-home'></i>Home</span></a></li><li><a href=http://localhost:1313/categories/miscellanea/ title=Miscellanea><span><i class='fa fa-file-text'></i>Miscellanea</span></a></li><li><a href=http://localhost:1313/categories/stm32/ title=STM32><span><i class='fa fa-microchip'></i>STM32</span></a></li><li><a href=http://localhost:1313/categories/esp32/ title=ESP32><span><i class='fa fa-wifi'></i>ESP32</span></a></li><li><a href=http://localhost:1313/categories/rp/ title=RP><span><i class='fa fa-raspberry-pi'></i>RP</span></a></li><li><a href=http://localhost:1313/categories/py32/ title=PY32><span><i class='fa py32'></i>PY32</span></a></li><li><a href=http://localhost:1313/categories/toolchain/ title=Toolchain><span><i class='fa fa-file-text'></i>Toolchain</span></a></li><li><a href=http://localhost:1313/categories/search/ title=Search><span><i class='fa fa-file-text'></i>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">00：点亮LED（GPIO）
<span class=entry-hint title=Draft><svg height="35" viewBox="0 -960 960 960" fill="currentColor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h1><div class=post-meta><span title='2025-08-14 18:39:34 +0800 CST'>August 14, 2025</span>&nbsp;·&nbsp;linkyourbin&nbsp;|&nbsp;<a href=https://github.com/linkyourbin/ rel="noopener noreferrer edit" target=_blank>error fix</a></div></header><div class=post-content><hr><p><img loading=lazy src=/memes/exhausted.jpg></p><h1 id=硬件准备>硬件准备<a hidden class=anchor aria-hidden=true href=#硬件准备>#</a></h1><ul><li><code>STM32</code>开发板*1</li><li>烧录器*1<ul><li>推荐使用<code>ST-Link</code></li></ul></li><li><code>LED</code>*1<ul><li>若有板载<code>LED</code>，则无需准备</li></ul></li><li>杜邦线若干</li></ul><hr><h1 id=硬件接线>硬件接线<a hidden class=anchor aria-hidden=true href=#硬件接线>#</a></h1><table><thead><tr><th>Peri</th><th>STM32</th></tr></thead><tbody><tr><td>LED</td><td>PC0</td></tr><tr><td>ST-Link SWDIO</td><td>SWDIO/PA13</td></tr><tr><td>ST-Link SWCLK</td><td>SWCLk/PA14</td></tr><tr><td>ST-Link GND</td><td>GND</td></tr><tr><td>ST-Link 3V3</td><td>3V3</td></tr></tbody></table><p>电路部分，如上表即可，不涉及其他外设，这样简单接线就可以工作，但是更推荐的做法是，使用<code>Type-C/USB</code>给板子<code>5V</code>供电，<code>5V</code>直流通过<code>LDO</code>或者<code>DC/DC</code>转为<code>3V3</code>后再给相应外设板子供电，这样会更稳定，若是部分外设需要<code>5V</code>供电，但系统里并未接入<code>5V</code>直流，则会导致外设无响应，或工作不正常，这是需要注意的一个点。</p><hr><h1 id=创建工程>创建工程<a hidden class=anchor aria-hidden=true href=#创建工程>#</a></h1><p>一般来说，可以直接使用一些别人写好的工具来创建模板（在<code>crates.io</code>上可以找到），类似<code>esp-generate</code>这样的工具，但是，由于<code>rust+embassy</code>一直都很活跃，使用别人的模板，难以保证体验最新特性，所以，介绍一下如何从<code>cargo new xxx</code>开始一个嵌入式<code>rust</code>的工程。</p><h2 id=创建空白工程>创建空白工程<a hidden class=anchor aria-hidden=true href=#创建空白工程>#</a></h2><ol><li>创建一个空白工程</li></ol><p>打开终端，输入：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cargo new stm32_blinky
</span></span></code></pre></td></tr></table></div></div><p>注意：工程名最好是<code>snake_case</code>。
<img loading=lazy src=/stm32/01-blinky/00_new_project.png></p><ol start=2><li>使用<code>vscode</code>打开所创建的工程</li></ol><p>工程目录如下图所示，标准的<code>hello world</code>工程。</p><p><img loading=lazy src=/stm32/01-blinky/01_open_project.png></p><h2 id=移植embassy>移植<code>embassy</code><a hidden class=anchor aria-hidden=true href=#移植embassy>#</a></h2><p>参考<code>embassy</code>仓库的工程进行工程移植，点击跳转<a href=https://github.com/embassy-rs/embassy/tree/main/examples/stm32f4><code>embassy stm32f4 examples</code></a></p><p>在自己的工程根目录里创建两个目录，并且新建文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>.config/config.toml
</span></span><span class=line><span class=cl>.vscode/settings.json
</span></span></code></pre></td></tr></table></div></div><p>将以下图中内容，复制到<code>.cargo/config.toml</code>里
<img loading=lazy src=/stm32/01-blinky/02_embassy_config.png></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>target</span><span class=p>.</span><span class=s1>&#39;cfg(all(target_arch = &#34;arm&#34;, target_os = &#34;none&#34;))&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c># replace STM32F407VETx with your chip as listed in `probe-rs chip list`</span>
</span></span><span class=line><span class=cl><span class=nx>runner</span> <span class=p>=</span> <span class=s2>&#34;probe-rs run --chip STM32F407VETx&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>build</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>target</span> <span class=p>=</span> <span class=s2>&#34;thumbv7em-none-eabihf&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>env</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>DEFMT_LOG</span> <span class=p>=</span> <span class=s2>&#34;trace&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>注意：以上内容并不是照抄，需要按照自己的开发板具体型号来适配芯片名称（<code>--chip xxx</code>），还有编译器（<code>target = "xxx"</code>）。</p><p>具体做法是：</p><p>先看自己的开发板是什么型号，例如，我手里的是<code>STM32F407VET6</code>，这个型号在购买开发板的时候可以看到，也可以在芯片上直接读到，由于不确定配置文件里的芯片名称格式，所以需要使用<code>probe-rs</code>提供的命令来查看支持的芯片还有格式书写。</p><ol><li>在终端里输入</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>probe-rs chip list
</span></span></code></pre></td></tr></table></div></div><p>可以看到，支持的芯片很多，但由于显示的问题，只显示了部分芯片型号。
<img loading=lazy src=/stm32/01-blinky/03_probers_chip_list.png></p><p>所以需要进行筛选，确定具体的型号。</p><p>注意，以下命令需要在<code>git bash</code>里进行，若是<code>linux/mac</code>则无需注意。</p><ol start=2><li>在终端里输入</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>probe-rs chip list <span class=p>|</span> grep STM32F4
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/stm32/01-blinky/04_probers_chip_grep_01.png></p><p>可以看到，已经筛选出了<code>F4</code>系列的芯片，进一步缩小范围。</p><ol start=3><li>在终端里输入</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>probe-rs chip list <span class=p>|</span> grep STM32F407
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/stm32/01-blinky/05_probers_chip_grep_02.png></p><p>可以看到，所列出的芯片型号中，<code>STM32F407VE</code>与我手里的<code>STM32F407VET6</code>就十分接近，那就选这个<code>STM32F407VE</code>填到<code>.cargo/config.toml</code>文件中<code>--chip xxx</code>的位置。</p><p>当然，也可以使用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>probe-rs chip list <span class=p>|</span> grep STM32* &gt; chip.txt
</span></span></code></pre></td></tr></table></div></div><p>将<code>STM32</code>系列的芯片型号，保存到一个<code>chip.txt</code>的文件里，再去手动查找。
<img loading=lazy src=/stm32/01-blinky/06_probers_chip_grep_03.png>
<img loading=lazy src=/stm32/01-blinky/07_probers_chip_grep_04.png></p><ol start=4><li>在<code>.vscode/settings.json</code>里粘贴以下内容</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rust-analyzer.check.allTargets&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>使用<code>rust</code>做嵌入式开发时，需要<code>no-std</code>，使用以上配置文件，就可以屏蔽报错。</p><ol start=5><li>复制<code>embassy examples</code>里的<code>build.rs</code>到自己的工程里</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;cargo:rustc-link-arg-bins=--nmagic&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;cargo:rustc-link-arg-bins=-Tlink.x&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;cargo:rustc-link-arg-bins=-Tdefmt.x&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=6><li>复制必要的依赖配置到根目录里的<code>Cargo.toml</code>文件里</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>package</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;stm32_blinky&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.1.0&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>edition</span> <span class=p>=</span> <span class=s2>&#34;2024&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>dependencies</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>embassy-stm32</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.4.0&#34;</span><span class=p>,</span>  <span class=nx>features</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;defmt&#34;</span><span class=p>,</span> <span class=s2>&#34;stm32f407ve&#34;</span><span class=p>,</span> <span class=s2>&#34;unstable-pac&#34;</span><span class=p>,</span> <span class=s2>&#34;memory-x&#34;</span><span class=p>,</span> <span class=s2>&#34;time-driver-any&#34;</span><span class=p>,</span> <span class=s2>&#34;exti&#34;</span><span class=p>,</span> <span class=s2>&#34;chrono&#34;</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>embassy-sync</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.7.2&#34;</span><span class=p>,</span>  <span class=nx>features</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;defmt&#34;</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>embassy-executor</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.9.0&#34;</span><span class=p>,</span>  <span class=nx>features</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;arch-cortex-m&#34;</span><span class=p>,</span> <span class=s2>&#34;executor-thread&#34;</span><span class=p>,</span> <span class=s2>&#34;executor-interrupt&#34;</span><span class=p>,</span> <span class=s2>&#34;defmt&#34;</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>embassy-time</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.5.0&#34;</span><span class=p>,</span> <span class=nx>features</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;defmt&#34;</span><span class=p>,</span> <span class=s2>&#34;defmt-timestamp-uptime&#34;</span><span class=p>,</span> <span class=s2>&#34;tick-hz-32_768&#34;</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>embassy-usb</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.5.1&#34;</span><span class=p>,</span>  <span class=nx>features</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;defmt&#34;</span> <span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>embassy-net</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.7.1&#34;</span><span class=p>,</span>  <span class=nx>features</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;defmt&#34;</span><span class=p>,</span> <span class=s2>&#34;tcp&#34;</span><span class=p>,</span> <span class=s2>&#34;dhcpv4&#34;</span><span class=p>,</span> <span class=s2>&#34;medium-ethernet&#34;</span><span class=p>,</span> <span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>embassy-net-wiznet</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.2.1&#34;</span><span class=p>,</span>  <span class=nx>features</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;defmt&#34;</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>embassy-futures</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.1.2&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>defmt</span> <span class=p>=</span> <span class=s2>&#34;1.0.1&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>defmt-rtt</span> <span class=p>=</span> <span class=s2>&#34;1.0.0&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>cortex-m</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.7.6&#34;</span><span class=p>,</span> <span class=nx>features</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;inline-asm&#34;</span><span class=p>,</span> <span class=s2>&#34;critical-section-single-core&#34;</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>cortex-m-rt</span> <span class=p>=</span> <span class=s2>&#34;0.7.0&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>embedded-hal</span> <span class=p>=</span> <span class=s2>&#34;0.2.6&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>embedded-hal-bus</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.2&#34;</span><span class=p>,</span> <span class=nx>features</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;async&#34;</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>embedded-io</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.6.0&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>embedded-io-async</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.6.1&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>panic-probe</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span> <span class=nx>features</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;print-defmt&#34;</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>futures-util</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.3.30&#34;</span><span class=p>,</span> <span class=nx>default-features</span> <span class=p>=</span> <span class=kc>false</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>heapless</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.8&#34;</span><span class=p>,</span> <span class=nx>default-features</span> <span class=p>=</span> <span class=kc>false</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>critical-section</span> <span class=p>=</span> <span class=s2>&#34;1.1&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>nb</span> <span class=p>=</span> <span class=s2>&#34;1.0.0&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>embedded-storage</span> <span class=p>=</span> <span class=s2>&#34;0.3.1&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>micromath</span> <span class=p>=</span> <span class=s2>&#34;2.0.0&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>usbd-hid</span> <span class=p>=</span> <span class=s2>&#34;0.8.1&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>static_cell</span> <span class=p>=</span> <span class=s2>&#34;2&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>chrono</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;^0.4&#34;</span><span class=p>,</span> <span class=nx>default-features</span> <span class=p>=</span> <span class=kc>false</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>profile</span><span class=p>.</span><span class=nx>release</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>debug</span> <span class=p>=</span> <span class=mi>2</span>
</span></span></code></pre></td></tr></table></div></div><p>注意：以上配置，均是来自<code>embassy</code>仓库，只是将<code>path</code>字段删除了，在编译的时候，会自动在线拉取，因为我们并没有将这些库拉取到本地，所以这个字段可以删除，当然也有其他配置的方式，例如指定<code>git</code>，大家感兴趣可以自行去探索。</p><p>大家可以自行对比，进行移植。最简单的方式就是复制上面的配置文件到自己的<code>Cargo.toml</code>文件里，再将<code>embassy-stm32 = { version = "0.4.0", features = ["defmt", "stm32f407ve", "unstable-pac", "memory-x", "time-driver-any", "exti", "chrono"] }</code>这个依赖里的<code>stm32f407ve</code>修改为前文教大家适配的自己的芯片型号即可。</p><h1 id=编写代码点灯>编写代码点灯<a hidden class=anchor aria-hidden=true href=#编写代码点灯>#</a></h1><p>完成了以上工程创建之后，就可以开始写代码点灯了。当然了，第一次，还是直接复制粘贴，局部调整即可。</p><p>将以下代码，粘贴到<code>main.rs</code>里。</p><h2 id=cv>CV<a hidden class=anchor aria-hidden=true href=#cv>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#![no_std]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#![no_main]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>defmt</span>::<span class=o>*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>embassy_executor</span>::<span class=n>Spawner</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>embassy_stm32</span>::<span class=n>gpio</span>::<span class=p>{</span><span class=n>Level</span><span class=p>,</span><span class=w> </span><span class=n>Output</span><span class=p>,</span><span class=w> </span><span class=n>Speed</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>embassy_time</span>::<span class=n>Timer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=p>{</span><span class=n>defmt_rtt</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>_</span><span class=p>,</span><span class=w> </span><span class=n>panic_probe</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>_</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[embassy_executor::main]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>main</span><span class=p>(</span><span class=n>_spawner</span>: <span class=nc>Spawner</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>embassy_stm32</span>::<span class=n>init</span><span class=p>(</span><span class=nb>Default</span>::<span class=n>default</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>info!</span><span class=p>(</span><span class=s>&#34;Hello World!&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>led</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Output</span>::<span class=n>new</span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=no>PC0</span><span class=p>,</span><span class=w> </span><span class=n>Level</span>::<span class=n>High</span><span class=p>,</span><span class=w> </span><span class=n>Speed</span>::<span class=n>Low</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>loop</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>info!</span><span class=p>(</span><span class=s>&#34;high&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>led</span><span class=p>.</span><span class=n>set_high</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Timer</span>::<span class=n>after_millis</span><span class=p>(</span><span class=mi>300</span><span class=p>).</span><span class=k>await</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>info!</span><span class=p>(</span><span class=s>&#34;low&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>led</span><span class=p>.</span><span class=n>set_low</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Timer</span>::<span class=n>after_millis</span><span class=p>(</span><span class=mi>300</span><span class=p>).</span><span class=k>await</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>只需要将<code>PC0</code>修改为自己板子所连接<code>LED</code>的引脚即可。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>let mut led = Output::new(p.PC0, Level::High, Speed::Low);
</span></span></code></pre></td></tr></table></div></div><h2 id=烧录>烧录<a hidden class=anchor aria-hidden=true href=#烧录>#</a></h2><p>确保烧录器、开发板、电脑连接无误，供电正常。</p><p>打开终端，输入</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cargo run --release
</span></span></code></pre></td></tr></table></div></div><p>开始编译，可以看到编译进度。</p><p><img loading=lazy src=/stm32/01-blinky/08_flash_01.png></p><p>编译完成后，开始下载，并且会在终端里打印出<code>info</code>函数里的内容。（可以用来做类似串口调试的工具。）</p><p><img loading=lazy src=/stm32/01-blinky/08_flash_02.png></p><p>至此，恭喜你完成了在<code>STM32</code>单片机上，使用<code>RUST</code>语言点灯。</p><p>所有的伟大，源于一个勇敢的开始。😊</p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/gpio/>GPIO</a></li><li><a href=http://localhost:1313/tags/easy/>Easy</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/rp/blinky/><span class=title>« Prev</span><br><span>Blinky</span>
</a><a class=next href=http://localhost:1313/miscellanea/miscellanea/><span class=title>Next »</span><br><span>杂记/小记/章节介绍</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>RUST MCU BLOG</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>